{% extends 'base.html' %}

{% block content %}
<div class="container">
    <!-- Left Sidebar -->
    <div class="sidebar">
        <h3>Welcome, {{ user.username }}!</h3>
        <p>Connect with friends and share your thoughts.</p>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Create Post Form -->
        <form method="post" action="{% url 'create_post' %}" class="post-form">
            {% csrf_token %}
            <textarea name="content" class="post-textarea" placeholder="What's on your mind?" required></textarea>
            <button type="submit" class="post-submit">Post</button>
        </form>

        <!-- Posts Feed -->
        {% for post in posts %}
        <div class="post">
            <div class="post-header">
                <a href="{% url 'profile' post.user.username %}" class="post-user">{{ post.user.username }}</a>
                <span class="post-time">{{ post.created_at|timesince }} ago</span>
            </div>
            
            <div class="post-content">
                {{ post.content|linebreaks }}
            </div>
            
            <div class="post-actions">
                <button class="action-btn like-btn {% if request.user in post.likes.all %}liked{% endif %}" data-post-id="{{ post.id }}">
                    Like (<span class="like-count">{{ post.likes.count }}</span>)
                </button>
                <button class="action-btn comment-btn">Comment</button>
            </div>

            <!-- Comments Section -->
            <div class="comment-section">
                {% for comment in post.comments.all|slice:":3" %}
                <div class="comment">
                    <strong>{{ comment.user.username }}:</strong> {{ comment.content }}
                </div>
                {% endfor %}
                
                <form method="post" action="{% url 'add_comment' post.id %}" class="comment-form">
                    {% csrf_token %}
                    <input type="text" name="content" class="comment-input" placeholder="Write a comment..." required>
                    <button type="submit" class="action-btn">Post</button>
                </form>
            </div>
        </div>
        {% empty %}
        <div class="post">
            <p>No posts yet. Be the first to post!</p>
        </div>
        {% endfor %}
    </div>

    <!-- Right Sidebar -->
    <div class="sidebar">
        <h3>Suggested Users</h3>
        {% for user in suggested_users %}
        <div class="user-card">
            <a href="{% url 'profile' user.username %}" style="text-decoration: none; color: inherit;">
                <strong>{{ user.username }}</strong>
            </a>
            <button class="follow-btn" data-user-id="{{ user.id }}">
                Follow
            </button>
        </div>
        {% empty %}
        <p>No suggested users.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
